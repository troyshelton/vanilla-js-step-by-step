<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± Contact Manager - Complete App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .button-group {
            margin: 10px 0;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .danger-btn {
            background: #dc3545;
        }

        .danger-btn:hover {
            background: #c82333;
        }

        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .input-group {
            margin: 10px 0;
        }

        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .stats {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .completion-banner {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="completion-banner" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
        <h1>‚úèÔ∏è Step 5: Update & Delete Operations (Optional/Advanced)</h1>
        <p><strong>Learning Goal:</strong> Complete CRUD operations, data modification, array manipulation</p>
        <p>üéØ Edit contacts, change group assignments, delete operations - real-world completeness</p>
        <p style="margin-top: 10px; font-size: 14px;">‚≠ê Optional: Steps 1-4 cover core architecture - this adds practical completeness</p>
    </div>

    <div class="container">
        <h2>üì± Contact Management</h2>

        <div class="input-group" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
            <input type="text" id="contact-name" placeholder="Name" style="flex: 1; min-width: 150px;">
            <input type="text" id="contact-phone" placeholder="Phone" style="flex: 1; min-width: 120px;">
            <input type="text" id="contact-email" placeholder="Email" style="flex: 1; min-width: 180px;">
            <div style="flex: 1; min-width: 180px; position: relative;">
                <label for="group-multiselect" style="font-size: 12px; color: #666; margin-bottom: 2px; display: block;">Groups (optional)</label>
                <select id="group-multiselect" multiple style="width: 100%; height: 60px; padding: 5px; border: 2px solid #ddd; border-radius: 4px; font-family: Arial, sans-serif;">
                    <!-- Groups will be populated dynamically -->
                </select>
            </div>
            <button onclick="addContactWithGroups()" style="white-space: nowrap;">Add Contact</button>
        </div>

        <div id="contact-output" class="output">Contact operations will appear here...</div>
    </div>

    <div class="container">
        <h2>‚úèÔ∏è Edit & Delete Contacts</h2>
        <p style="margin: 10px 0; color: #666;">Manage existing contacts - edit information or remove contacts</p>

        <div class="button-group">
            <button onclick="showManageContacts()">Show All Contacts to Manage</button>
            <button onclick="refreshManageView()">Refresh List</button>
        </div>

        <div id="manage-output" class="output">Click "Show All Contacts to Manage" to see edit/delete options</div>
    </div>

    <div class="container">
        <h2>üë• Group Management</h2>

        <div class="input-group" style="display: flex; align-items: center; gap: 10px;">
            <input type="text" id="group-name" placeholder="Group Name" value="" style="width: 200px;">
            <button onclick="createGroup()">Create Group</button>
            <span style="font-style: italic; color: #666; font-size: 14px;">
                üí° Examples: Family, Church, Fishing, Book Club, etc.
            </span>
        </div>

        <div id="group-output" class="output">Group operations will appear here...</div>
    </div>

    <div class="container">
        <h2>üîç Search & Reports</h2>

        <div style="display: flex; gap: 20px; margin-bottom: 15px;">
            <!-- Search Section -->
            <div style="flex: 1; border: 1px solid #ddd; padding: 15px; border-radius: 4px;">
                <h4 style="margin-top: 0; color: #666;">Search</h4>
                <div class="input-group" style="display: flex; gap: 5px; align-items: center;">
                    <input type="text" id="search-term" placeholder="Search..." style="width: 200px;">
                    <button onclick="searchContacts()">Search Contacts</button>
                    <button onclick="searchGroups()">Search Groups</button>
                </div>
            </div>

            <!-- View/Reports Section -->
            <div style="flex: 1; border: 1px solid #ddd; padding: 15px; border-radius: 4px;">
                <h4 style="margin-top: 0; color: #666;">Show/Reports</h4>
                <div class="button-group">
                    <button onclick="showAllContacts()">Show All Contacts</button>
                    <button onclick="showUnassignedContacts()">Show Unassigned</button>
                    <button onclick="showGroupsList()">Show Groups & Members</button>
                </div>
            </div>
        </div>

        <div id="search-output" class="output">Search results will appear here...</div>
    </div>

    <div class="container">
        <h2>üß™ JavaScript Architecture Learning</h2>
        <div class="button-group">
            <button onclick="showGlobalServices()">Show Global Services</button>
            <button onclick="demonstrateServiceCommunication()">Service Communication</button>
            <button onclick="showConsoleCommands()">Console Commands Guide</button>
            <button class="danger-btn" onclick="clearAllData()">Clear All Data</button>
        </div>
        <div id="demo-output" class="output">
            üéØ Learning Focus: Manual interaction teaches JavaScript concepts better!<br><br>
            üí° Try adding contacts and groups manually, then use console commands to see how services work together.
        </div>
    </div>

    <!--
        CRITICAL: Load order matters!
        SearchService depends on both ContactService and GroupService
    -->
    <script src="ContactService.js"></script>
    <script src="GroupService.js"></script>
    <script src="SearchService.js"></script>

    <script>
        // Global service instances
        let contactService;
        let groupService;
        let searchService;

        // Initialize services when page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                contactService = new ContactService();
                groupService = new GroupService();
                searchService = SearchService.createWithGlobalServices(contactService, groupService);

                // Initialize the multi-select with placeholder
                updateGroupCheckboxes();

                console.log('üéâ All services initialized successfully!');
            } catch (error) {
                console.error('‚ùå Initialization failed:', error.message);
            }
        });

        // === CONTACT MANAGEMENT FUNCTIONS ===

        // Update group multi-select when groups change
        function updateGroupCheckboxes() {
            const multiSelect = document.getElementById('group-multiselect');
            const groups = groupService.getAllGroups();

            // Clear existing options
            multiSelect.innerHTML = '';

            // If no groups exist, leave multi-select empty (label explains purpose)
            if (groups.length === 0) {
                return;
            }

            // Add option for each group
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                multiSelect.appendChild(option);
            });

            console.log(`üîÑ Updated group multi-select - now showing ${groups.length} groups`);
        }

        function addContactWithGroups() {
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            const email = document.getElementById('contact-email').value;
            const output = document.getElementById('contact-output');

            if (!name || !phone || !email) {
                output.textContent = '‚ùå Please fill in all fields (name, phone, email)';
                return;
            }

            // Add the contact first
            const contactId = contactService.addContact(name, phone, email);

            // Get selected groups from multi-select
            const selectedGroups = [];
            const multiSelect = document.getElementById('group-multiselect');
            const selectedOptions = Array.from(multiSelect.selectedOptions);

            selectedOptions.forEach(option => {
                const groupId = option.value;
                const groupName = option.textContent;
                selectedGroups.push({ id: groupId, name: groupName });

                // Assign contact to selected group
                groupService.addContactToGroup(groupId, contactId);
            });

            // Show results
            output.textContent = `‚úÖ Contact added: ${name}\n`;
            output.textContent += `üìß ${email} | üìû ${phone}\n\n`;

            if (selectedGroups.length > 0) {
                output.textContent += `üë• Assigned to groups:\n`;
                selectedGroups.forEach(group => {
                    output.textContent += `‚Ä¢ ${group.name}\n`;
                });
                output.textContent += `\nüîç This demonstrates:\n`;
                output.textContent += `‚Ä¢ ContactService creating contact\n`;
                output.textContent += `‚Ä¢ GroupService linking contact to groups\n`;
                output.textContent += `‚Ä¢ Services communicating through method calls`;
            } else {
                output.textContent += `üìù Status: Unassigned (no groups selected)\n\n`;
                output.textContent += `üîç This demonstrates:\n`;
                output.textContent += `‚Ä¢ Contacts can exist without group assignments\n`;
                output.textContent += `‚Ä¢ Optional relationships in service architecture\n`;
                output.textContent += `‚Ä¢ Use "Show All Contacts" to see unassigned contacts`;
            }

            // Clear form
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-phone').value = '';
            document.getElementById('contact-email').value = '';

            // Reset multi-select to placeholder
            document.getElementById('group-multiselect').selectedIndex = 0;
        }

        function addContact() {
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            const email = document.getElementById('contact-email').value;
            const output = document.getElementById('contact-output');

            if (name && phone && email) {
                const contactId = contactService.addContact(name, phone, email);
                output.textContent = `‚úÖ Contact added: ${name}\nID: ${contactId}\nPhone: ${phone}\nEmail: ${email}`;

                // Clear inputs
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-phone').value = '';
                document.getElementById('contact-email').value = '';
            } else {
                output.textContent = '‚ùå Please fill in all fields (name, phone, email)';
            }
        }




        // === GROUP MANAGEMENT FUNCTIONS ===

        function createGroup() {
            const name = document.getElementById('group-name').value.trim();
            const output = document.getElementById('group-output');

            if (name) {
                // Use the group name as its own type (no artificial categorization)
                const groupId = groupService.createGroup(name, name.toLowerCase());
                output.textContent = `‚úÖ Group created: "${name}"\nID: ${groupId}\n\n`;

                // DYNAMIC UPDATE: Refresh checkboxes in contact section
                updateGroupCheckboxes();

                output.textContent += `üîÑ Contact assignment options updated!\n`;
                output.textContent += `üí° Go to Contact Management - "${name}" now available for assignment\n\n`;
                output.textContent += `üîç This demonstrates:\n`;
                output.textContent += `‚Ä¢ Service data driving UI updates\n`;
                output.textContent += `‚Ä¢ Dynamic content generation from service state\n`;
                output.textContent += `‚Ä¢ Flexible group creation (no artificial categories)\n`;
                output.textContent += `‚Ä¢ Real-world contact organization patterns`;

                // Clear input
                document.getElementById('group-name').value = '';
            } else {
                output.textContent = '‚ùå Please enter a group name';
            }
        }


        function manuallyAssignContact() {
            const output = document.getElementById('group-output');
            const contacts = contactService.getAllContacts();
            const groups = groupService.getAllGroups();

            if (contacts.length === 0) {
                output.textContent = '‚ùå Add contacts first!\nUse Contact Management section to add contacts.';
                return;
            }

            if (groups.length === 0) {
                output.textContent = '‚ùå Create groups first!\nUse Group Management section to create groups.';
                return;
            }

            // Simple manual assignment demo
            output.textContent = 'üìù Manual Assignment Demo:\n\n';
            output.textContent += 'üéØ Learning Goal: See how services communicate\n\n';

            // Show first contact and first group as example
            const firstContact = contacts[0];
            const firstGroup = groups[0];

            output.textContent += `Example Assignment:\n`;
            output.textContent += `Contact: ${firstContact.name}\n`;
            output.textContent += `Group: ${firstGroup.name}\n\n`;

            // Perform the assignment
            const success = groupService.addContactToGroup(firstGroup.id, firstContact.id);

            if (success) {
                output.textContent += `‚úÖ Assigned ${firstContact.name} to ${firstGroup.name}\n\n`;
                output.textContent += 'üîç This demonstrates:\n';
                output.textContent += '‚Ä¢ GroupService using ContactService data\n';
                output.textContent += '‚Ä¢ Services communicating through method calls\n';
                output.textContent += '‚Ä¢ Global namespace allowing service access\n\n';
                output.textContent += 'üí° Try "Show Family/Friends/Coworkers" to see the result!';
            } else {
                output.textContent += '‚ö†Ô∏è Assignment may have already existed\n';
                output.textContent += 'This shows duplicate prevention in the service!';
            }
        }


        // === SEARCH FUNCTIONS ===

        function searchContacts() {
            const searchTerm = document.getElementById('search-term').value;
            const output = document.getElementById('search-output');

            const results = searchService.searchContacts(searchTerm);

            output.textContent = `üîç Search results for "${searchTerm}":\n\n`;
            if (results.length > 0) {
                results.forEach((contact, index) => {
                    output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                });
            } else {
                output.textContent += '‚ùå No contacts found';
            }
        }

        function searchGroups() {
            const searchTerm = document.getElementById('search-term').value;
            const output = document.getElementById('search-output');

            const results = searchService.searchGroups(searchTerm);

            output.textContent = `üîç Group search results for "${searchTerm}":\n\n`;
            if (results.length > 0) {
                results.forEach((group, index) => {
                    output.textContent += `${index + 1}. ${group.name} (${group.type}) - ${group.contactIds.length} members\n`;
                });
            } else {
                output.textContent += '‚ùå No groups found';
            }
        }

        function showGroupsList() {
            const output = document.getElementById('search-output');
            const groups = groupService.getAllGroups();

            if (groups.length === 0) {
                output.textContent = '‚ùå No groups created yet!\n\n';
                output.textContent += 'üí° Create groups using Group Management section';
                return;
            }

            output.textContent = `üë• All Groups & Their Members:\n\n`;

            groups.forEach((group, index) => {
                // Get contacts in this specific group
                const groupContacts = groupService.getContactsInGroup(group.id, contactService);

                output.textContent += `${index + 1}. ${group.name} (${groupContacts.length} members)\n`;

                if (groupContacts.length > 0) {
                    groupContacts.forEach(contact => {
                        output.textContent += `   ‚Ä¢ ${contact.name} - ${contact.phone}\n`;
                    });
                } else {
                    output.textContent += `   (No members yet)\n`;
                }
                output.textContent += `\n`;
            });

            output.textContent += `üîç This demonstrates:\n`;
            output.textContent += `‚Ä¢ GroupService managing any type of group\n`;
            output.textContent += `‚Ä¢ SearchService coordinating with GroupService\n`;
            output.textContent += `‚Ä¢ Flexible contact organization patterns\n`;
            output.textContent += `‚Ä¢ No artificial type restrictions`;
        }

        function showAllContacts() {
            const output = document.getElementById('search-output');
            const contacts = searchService.getAllContacts();

            output.textContent = `üì± All Contacts (${contacts.length}):\n\n`;
            if (contacts.length === 0) {
                output.textContent += 'üí° Add contacts using Contact Management section';
                return;
            }

            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                output.textContent += `   üìß ${contact.email}\n\n`;
            });

            output.textContent += 'üîç This demonstrates:\n';
            output.textContent += '‚Ä¢ SearchService accessing ContactService data\n';
            output.textContent += '‚Ä¢ Service method calls: searchService.getAllContacts()\n';
            output.textContent += '‚Ä¢ Cross-service communication through global namespace';
        }

        function showUnassignedContacts() {
            const output = document.getElementById('search-output');
            const unassignedContacts = searchService.getUnassignedContacts();

            output.textContent = `üìã Unassigned Contacts (${unassignedContacts.length}):\n\n`;

            if (unassignedContacts.length === 0) {
                output.textContent += '‚úÖ All contacts are assigned to groups!\n\n';
                output.textContent += 'üí° Try adding a contact without checking any groups';
            } else {
                unassignedContacts.forEach((contact, index) => {
                    output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                    output.textContent += `   üìß ${contact.email}\n`;
                    output.textContent += `   ID: ${contact.id.substr(-8)}\n\n`;
                });

                output.textContent += 'üîç This demonstrates:\n';
                output.textContent += '‚Ä¢ GroupService finding contacts NOT in any groups\n';
                output.textContent += '‚Ä¢ SearchService coordinating between services\n';
                output.textContent += '‚Ä¢ Optional relationships in service architecture\n\n';

                output.textContent += 'üí° To assign these contacts:\n';
                output.textContent += 'Use console: groupService.addContactToGroup(groupId, contactId)';
            }
        }


        // === CONSOLE HELPER FUNCTIONS FOR ID LOOKUP ===

        // Get all contact IDs in a nice table format
        window.getContactIds = function() {
            const contacts = contactService.getAllContacts();
            if (contacts.length === 0) {
                console.log('üì± No contacts yet!');
                return [];
            }
            console.log('üì± All Contact IDs:');
            console.table(contacts.map(c => ({
                ID: c.id,
                Name: c.name,
                Phone: c.phone,
                Email: c.email
            })));
            return contacts;
        };

        // Get all group IDs in a nice table format
        window.getGroupIds = function() {
            const groups = groupService.getAllGroups();
            if (groups.length === 0) {
                console.log('üë• No groups yet!');
                return [];
            }
            console.log('üë• All Group IDs:');
            console.table(groups.map(g => ({
                ID: g.id,
                Name: g.name,
                Members: g.contactIds.length
            })));
            return groups;
        };

        // Find contact ID by searching name
        window.findContactId = function(searchTerm) {
            const found = contactService.findContact(searchTerm);
            if (found) {
                console.log(`‚úÖ Found: ${found.name}`);
                console.log(`üìã ID: ${found.id}`);
                console.log(`\nüí° Copy this ID to use in edit/delete commands`);
                return found.id;
            } else {
                console.log(`‚ùå No contact found containing: "${searchTerm}"`);
                return null;
            }
        };

        // Show all IDs formatted for easy copy/paste
        window.showIds = function() {
            console.group('üìã All IDs (Easy Copy/Paste Format)');

            const contacts = contactService.getAllContacts();
            const groups = groupService.getAllGroups();

            console.log('\nüë• CONTACTS:');
            if (contacts.length === 0) {
                console.log('  (No contacts yet)');
            } else {
                contacts.forEach(c => {
                    console.log(`  ${c.name}: '${c.id}'`);
                });
            }

            console.log('\nüè∑Ô∏è  GROUPS:');
            if (groups.length === 0) {
                console.log('  (No groups yet)');
            } else {
                groups.forEach(g => {
                    console.log(`  ${g.name}: '${g.id}'`);
                });
            }

            console.groupEnd();
            console.log('\nüí° Copy the IDs from above to use in your commands');
            return { contacts, groups };
        };

        // Help function - shows all available console commands
        window.help = function() {
            console.group('üí° Available Console Commands - Step 5');

            console.log('\nüìã ID Lookup Helpers:');
            console.log('  getContactIds()              - Show all contact IDs in table');
            console.log('  getGroupIds()                - Show all group IDs in table');
            console.log('  findContactId("name")        - Find specific contact ID');
            console.log('  showIds()                    - Show all IDs for copy/paste');

            console.log('\n‚úèÔ∏è Edit Operations:');
            console.log('  editContact(contactId)       - Get edit instructions');
            console.log('  contactService.updateContact(id, {name, phone, email})');

            console.log('\nüóëÔ∏è Delete Operations:');
            console.log('  deleteContact(contactId)     - Delete with confirmation');

            console.log('\nüîÑ Group Operations:');
            console.log('  changeContactGroups(contactId, [groupIds])  - REPLACE all groups');
            console.log('  addToGroup(contactId, groupId)              - Add to one group');
            console.log('  removeFromGroup(contactId, groupId)         - Remove from one group');

            console.log('\nüîÑ Refresh:');
            console.log('  refreshManageView()                         - Update management panel');

            console.groupEnd();
            console.log('\nüéØ Start with: showIds() to see all available IDs!');
        };

        // === EDIT & DELETE CONTACT MANAGEMENT ===

        let editingContactId = null;

        function showManageContacts() {
            const output = document.getElementById('manage-output');
            const contactsWithGroups = searchService.getAllContactsWithGroupInfo();

            if (contactsWithGroups.length === 0) {
                output.textContent = 'üì± No contacts to manage yet!\n\nüí° Add contacts first using Contact Management section.';
                return;
            }

            output.textContent = `‚úèÔ∏è Manage Contacts (${contactsWithGroups.length}):\n\n`;

            contactsWithGroups.forEach((item, index) => {
                const contact = item.contact;
                const groupNames = item.groups.map(g => g.name).join(', ') || 'Unassigned';

                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                output.textContent += `   üìß ${contact.email}\n`;
                output.textContent += `   üë• Groups: ${groupNames}\n`;
                output.textContent += `   ID: ${contact.id.substr(-8)}\n\n`;
            });

            output.textContent += `üí° To edit or delete contacts, use console commands:\n`;
            output.textContent += `\n‚úèÔ∏è Edit contact:\n`;
            output.textContent += `editContact('contact_id');\n`;
            output.textContent += `\nüóëÔ∏è Delete contact:\n`;
            output.textContent += `deleteContact('contact_id');\n`;
            output.textContent += `\nüîÑ Change groups:\n`;
            output.textContent += `changeContactGroups('contact_id', ['group_id_1', 'group_id_2']);\n`;
        }

        function refreshManageView() {
            showManageContacts();
            return true;
        }

        // Edit contact (call from console)
        window.editContact = function(contactId) {
            const contact = contactService.getContactById(contactId);
            if (!contact) {
                console.error(`‚ùå Contact not found: ${contactId}`);
                return;
            }

            console.group(`‚úèÔ∏è Editing: ${contact.name}`);
            console.log('Current info:', contact);
            console.log('\nTo update, use:');
            console.log(`contactService.updateContact('${contactId}', {`);
            console.log(`    name: 'New Name',`);
            console.log(`    phone: '555-9999',`);
            console.log(`    email: 'new@email.com'`);
            console.log(`});`);
            console.log('\nThen run: refreshManageView() to see changes');
            console.groupEnd();

            return contact;
        };

        // Delete contact (call from console)
        window.deleteContact = function(contactId) {
            const contact = contactService.getContactById(contactId);
            if (!contact) {
                console.error(`‚ùå Contact not found: ${contactId}`);
                return false;
            }

            const confirmDelete = confirm(`Delete ${contact.name}?\n\nThis will remove the contact and all group assignments.`);

            if (confirmDelete) {
                // Remove from all groups first
                const groups = groupService.getAllGroups();
                groups.forEach(group => {
                    groupService.removeContactFromGroup(group.id, contactId);
                });

                // Delete the contact
                const success = contactService.removeContact(contactId);

                if (success) {
                    console.log(`‚úÖ Deleted: ${contact.name}`);
                    console.log('Run: refreshManageView() to update the list');
                    return true;
                }
            } else {
                console.log('‚ùå Delete cancelled');
                return false;
            }
        };

        // Change contact groups - REPLACES all group memberships (call from console)
        window.changeContactGroups = function(contactId, newGroupIds) {
            const contact = contactService.getContactById(contactId);
            if (!contact) {
                console.error(`‚ùå Contact not found: ${contactId}`);
                return false;
            }

            // Remove from all current groups
            const allGroups = groupService.getAllGroups();
            allGroups.forEach(group => {
                groupService.removeContactFromGroup(group.id, contactId);
            });

            // Add to new groups
            newGroupIds.forEach(groupId => {
                groupService.addContactToGroup(groupId, contactId);
            });

            console.log(`‚úÖ Updated groups for: ${contact.name}`);
            console.log(`üìã Now in: ${newGroupIds.length} group(s)`);
            console.log('Run: refreshManageView() to see changes');
            return true;
        };

        // Add contact to a specific group (call from console)
        window.addToGroup = function(contactId, groupId) {
            const contact = contactService.getContactById(contactId);
            const group = groupService.getAllGroups().find(g => g.id === groupId);

            if (!contact) {
                console.error(`‚ùå Contact not found: ${contactId}`);
                return false;
            }

            if (!group) {
                console.error(`‚ùå Group not found: ${groupId}`);
                return false;
            }

            const success = groupService.addContactToGroup(groupId, contactId);

            if (success) {
                console.log(`‚úÖ Added ${contact.name} to ${group.name}`);
                console.log('Run: refreshManageView() to see changes');
            } else {
                console.log(`‚ö†Ô∏è ${contact.name} already in ${group.name}`);
            }

            return success;
        };

        // Remove contact from a specific group (call from console)
        window.removeFromGroup = function(contactId, groupId) {
            const contact = contactService.getContactById(contactId);
            const group = groupService.getAllGroups().find(g => g.id === groupId);

            if (!contact) {
                console.error(`‚ùå Contact not found: ${contactId}`);
                return false;
            }

            if (!group) {
                console.error(`‚ùå Group not found: ${groupId}`);
                return false;
            }

            const success = groupService.removeContactFromGroup(groupId, contactId);

            if (success) {
                console.log(`‚úÖ Removed ${contact.name} from ${group.name}`);
                console.log('Run: refreshManageView() to see changes');
            } else {
                console.log(`‚ö†Ô∏è ${contact.name} not in ${group.name}`);
            }

            return success;
        };

        // === ARCHITECTURE DEMONSTRATION ===

        function showGlobalServices() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = `üåê Global Services Available:\n\n`;
            output.textContent += `‚úÖ ContactService: ${typeof window.ContactService === 'function'}\n`;
            output.textContent += `‚úÖ GroupService: ${typeof window.GroupService === 'function'}\n`;
            output.textContent += `‚úÖ SearchService: ${typeof window.SearchService === 'function'}\n\n`;
            output.textContent += `üí° Access them anywhere:\n`;
            output.textContent += `- window.ContactService or just ContactService\n`;
            output.textContent += `- window.GroupService or just GroupService\n`;
            output.textContent += `- window.SearchService or just SearchService`;
        }

        function demonstrateServiceCommunication() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = `üîó Service Communication Demonstration:\n\n`;

            // Show how SearchService uses both other services
            output.textContent += `1. SearchService depends on:\n`;
            output.textContent += `   - ContactService (for contact data)\n`;
            output.textContent += `   - GroupService (for group data)\n\n`;

            output.textContent += `2. When SearchService.createWithGlobalServices() is called:\n`;
            output.textContent += `   - It checks if ContactService exists globally\n`;
            output.textContent += `   - It checks if GroupService exists globally\n`;
            output.textContent += `   - It creates instances of both\n`;
            output.textContent += `   - It uses them to provide search functionality\n\n`;

            output.textContent += `3. This is why load order matters:\n`;
            output.textContent += `   ContactService.js ‚Üí GroupService.js ‚Üí SearchService.js`;
        }

        function showConsoleCommands() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = 'üíª Console Commands for Learning:\n\n';
            output.textContent += 'üéØ Open browser console (F12) and try these:\n\n';

            output.textContent += 'üì± Manual Contact Management:\n';
            output.textContent += `contactService.addContact('Your Name', '555-1234', 'you@email.com');\n`;
            output.textContent += `contactService.findContact('your');\n`;
            output.textContent += `contactService.getAllContacts();\n\n`;

            output.textContent += 'üë• Manual Group Management:\n';
            output.textContent += `groupService.createGroup('My Friends', 'friends');\n`;
            output.textContent += `groupService.getAllGroups();\n\n`;

            output.textContent += 'üîó Manual Assignment (Service Communication):\n';
            output.textContent += '// Get contact and group IDs from lists above, then:\n';
            output.textContent += `groupService.addContactToGroup(groupId, contactId);\n\n`;

            output.textContent += 'üîç Cross-Service Search:\n';
            output.textContent += `searchService.searchContacts('name');\n`;
            output.textContent += `searchService.getContactsByGroupType('friends');\n\n`;

            output.textContent += 'üåê Test Global Namespace:\n';
            output.textContent += `console.log(typeof ContactService);  // "function"\n`;
            output.textContent += `const newInstance = new ContactService();  // Independent data\n\n`;

            output.textContent += 'üí° This manual approach teaches:\n';
            output.textContent += '‚Ä¢ IIFE pattern (global exposure)\n';
            output.textContent += '‚Ä¢ Prototype method sharing\n';
            output.textContent += '‚Ä¢ Service dependencies\n';
            output.textContent += '‚Ä¢ Instance data separation';
        }

        function clearAllData() {
            // Create fresh instances to clear all data
            contactService = new ContactService();
            groupService = new GroupService();
            searchService = SearchService.createWithGlobalServices();

            // Clear all output areas
            document.getElementById('contact-output').textContent = 'All data cleared!';
            document.getElementById('group-output').textContent = 'All data cleared!';
            document.getElementById('search-output').textContent = 'All data cleared!';
            document.getElementById('demo-output').textContent = 'All data cleared!';

            console.log('üóëÔ∏è All data cleared - fresh start!');
        }

        // Global debug function
        window.debugContactManager = function() {
            console.group('üîç Contact Manager Debug Info');
            console.log('ContactService instance:', contactService);
            console.log('GroupService instance:', groupService);
            console.log('SearchService instance:', searchService);
            console.log('Total contacts:', contactService.getContactCount());
            console.log('Total groups:', groupService.getAllGroups().length);
            console.groupEnd();
        };
    </script>
</body>
</html>