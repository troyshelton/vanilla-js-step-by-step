<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± Contact Manager - Complete App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .button-group {
            margin: 10px 0;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .danger-btn {
            background: #dc3545;
        }

        .danger-btn:hover {
            background: #c82333;
        }

        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .input-group {
            margin: 10px 0;
        }

        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .stats {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .completion-banner {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="completion-banner">
        <h1>üéì JavaScript Architecture Demo - Final Version</h1>
        <p><strong>Learning Focus:</strong> See how IIFE, prototypes, and service dependencies work together</p>
        <p>üìö Reference solution for Steps 1-4 | üéØ Manually input data to learn concepts</p>
    </div>

    <div class="container">
        <h2>üì± Contact Management</h2>
        <p style="margin: 10px 0; color: #666;">
            üí° <strong>Groups Multi-Select:</strong> Ctrl+Click (PC) or Cmd+Click (Mac) to select multiple groups, or leave empty for unassigned contact
        </p>

        <div class="input-group" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
            <input type="text" id="contact-name" placeholder="Name" value="John Smith" style="flex: 1; min-width: 150px;">
            <input type="text" id="contact-phone" placeholder="Phone" value="555-0123" style="flex: 1; min-width: 120px;">
            <input type="text" id="contact-email" placeholder="Email" value="john@email.com" style="flex: 1; min-width: 180px;">
            <select id="group-multiselect" multiple style="flex: 1; min-width: 180px; height: 60px; padding: 5px; border: 2px solid #ddd; border-radius: 4px; font-family: Arial, sans-serif;">
                <!-- Dynamic options will appear here -->
            </select>
            <button onclick="addContactWithGroups()" style="white-space: nowrap;">Add Contact</button>
        </div>

        <div class="button-group">
            <button onclick="listAllContacts()">List All Contacts</button>
            <button onclick="findContactDemo()">Find Contact Demo</button>
        </div>
        <div id="contact-output" class="output">Contact operations will appear here...</div>
    </div>

    <div class="container">
        <h2>üë• Group Management</h2>

        <div class="input-group">
            <input type="text" id="group-name" placeholder="Group Name (e.g., Family, Church, Fishing Buddies)" value="">
            <button onclick="createGroup()">Create Group</button>
        </div>
        <p style="margin: 10px 0; font-style: italic; color: #666;">
            üí° Create any type of group: Family, Friends, Coworkers, Church, Fishing, Book Club, etc.
        </p>

        <div class="button-group">
            <button onclick="listAllGroups()">List All Groups</button>
            <button onclick="manuallyAssignContact()">Assign Contact to Group</button>
        </div>
        <div id="group-output" class="output">Group operations will appear here...</div>
    </div>

    <div class="container">
        <h2>üîç Search & Reports</h2>

        <div class="input-group">
            <input type="text" id="search-term" placeholder="Search contacts..." value="john">
            <button onclick="searchContacts()">Search Contacts</button>
            <button onclick="searchGroups()">Search Groups</button>
        </div>

        <div class="button-group">
            <button onclick="showAllContacts()">Show All Contacts</button>
            <button onclick="showUnassignedContacts()">Show Unassigned</button>
        </div>
        <div class="button-group">
            <button onclick="showGroupsList()">Show Groups & Members</button>
        </div>
        <div id="search-output" class="output">Search results will appear here...</div>
    </div>

    <div class="container">
        <h2>üß™ JavaScript Architecture Learning</h2>
        <div class="button-group">
            <button onclick="showGlobalServices()">Show Global Services</button>
            <button onclick="demonstrateServiceCommunication()">Service Communication</button>
            <button onclick="showConsoleCommands()">Console Commands Guide</button>
            <button class="danger-btn" onclick="clearAllData()">Clear All Data</button>
        </div>
        <div id="demo-output" class="output">
            üéØ Learning Focus: Manual interaction teaches JavaScript concepts better!<br><br>
            üí° Try adding contacts and groups manually, then use console commands to see how services work together.
        </div>
    </div>

    <!--
        CRITICAL: Load order matters!
        SearchService depends on both ContactService and GroupService
    -->
    <script src="ContactService.js"></script>
    <script src="GroupService.js"></script>
    <script src="SearchService.js"></script>

    <script>
        // Global service instances
        let contactService;
        let groupService;
        let searchService;

        // Initialize services when page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                contactService = new ContactService();
                groupService = new GroupService();
                searchService = SearchService.createWithGlobalServices(contactService, groupService);

                // Initialize the multi-select with placeholder
                updateGroupCheckboxes();

                console.log('üéâ All services initialized successfully!');
            } catch (error) {
                console.error('‚ùå Initialization failed:', error.message);
            }
        });

        // === CONTACT MANAGEMENT FUNCTIONS ===

        // Update group multi-select when groups change
        function updateGroupCheckboxes() {
            const multiSelect = document.getElementById('group-multiselect');
            const groups = groupService.getAllGroups();

            // Clear existing options
            multiSelect.innerHTML = '';

            // Always add a default placeholder option
            const placeholderOption = document.createElement('option');
            placeholderOption.value = '';
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            placeholderOption.style.fontStyle = 'italic';
            placeholderOption.style.color = '#999';

            if (groups.length === 0) {
                placeholderOption.textContent = 'Select groups... (create groups first)';
            } else {
                placeholderOption.textContent = 'Select groups... (Ctrl+Click for multiple)';
            }

            multiSelect.appendChild(placeholderOption);

            if (groups.length === 0) {
                return;
            }

            // Add option for each group
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                multiSelect.appendChild(option);
            });

            console.log(`üîÑ Updated group multi-select - now showing ${groups.length} groups`);
        }

        function addContactWithGroups() {
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            const email = document.getElementById('contact-email').value;
            const output = document.getElementById('contact-output');

            if (!name || !phone || !email) {
                output.textContent = '‚ùå Please fill in all fields (name, phone, email)';
                return;
            }

            // Add the contact first
            const contactId = contactService.addContact(name, phone, email);

            // Get selected groups from multi-select
            const selectedGroups = [];
            const multiSelect = document.getElementById('group-multiselect');
            const selectedOptions = Array.from(multiSelect.selectedOptions);

            selectedOptions.forEach(option => {
                const groupId = option.value;
                const groupName = option.textContent;
                selectedGroups.push({ id: groupId, name: groupName });

                // Assign contact to selected group
                groupService.addContactToGroup(groupId, contactId);
            });

            // Show results
            output.textContent = `‚úÖ Contact added: ${name}\n`;
            output.textContent += `üìß ${email} | üìû ${phone}\n\n`;

            if (selectedGroups.length > 0) {
                output.textContent += `üë• Assigned to groups:\n`;
                selectedGroups.forEach(group => {
                    output.textContent += `‚Ä¢ ${group.name}\n`;
                });
                output.textContent += `\nüîç This demonstrates:\n`;
                output.textContent += `‚Ä¢ ContactService creating contact\n`;
                output.textContent += `‚Ä¢ GroupService linking contact to groups\n`;
                output.textContent += `‚Ä¢ Services communicating through method calls`;
            } else {
                output.textContent += `üìù Status: Unassigned (no groups selected)\n\n`;
                output.textContent += `üîç This demonstrates:\n`;
                output.textContent += `‚Ä¢ Contacts can exist without group assignments\n`;
                output.textContent += `‚Ä¢ Optional relationships in service architecture\n`;
                output.textContent += `‚Ä¢ Use "Show All Contacts" to see unassigned contacts`;
            }

            // Clear form
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-phone').value = '';
            document.getElementById('contact-email').value = '';

            // Reset multi-select to placeholder
            const multiSelect = document.getElementById('group-multiselect');
            multiSelect.selectedIndex = 0; // Select the placeholder option
        }

        function addContact() {
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            const email = document.getElementById('contact-email').value;
            const output = document.getElementById('contact-output');

            if (name && phone && email) {
                const contactId = contactService.addContact(name, phone, email);
                output.textContent = `‚úÖ Contact added: ${name}\nID: ${contactId}\nPhone: ${phone}\nEmail: ${email}`;

                // Clear inputs
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-phone').value = '';
                document.getElementById('contact-email').value = '';
            } else {
                output.textContent = '‚ùå Please fill in all fields (name, phone, email)';
            }
        }

        function manuallyAssignContact() {
            const output = document.getElementById('group-output');
            const contacts = contactService.getAllContacts();
            const groups = groupService.getAllGroups();

            if (contacts.length === 0) {
                output.textContent = '‚ùå No contacts found!\nAdd contacts first using the Contact Management section.';
                return;
            }

            if (groups.length === 0) {
                output.textContent = '‚ùå No groups found!\nCreate groups first using the Group Management section.';
                return;
            }

            // Simple manual assignment interface
            output.textContent = 'üìù Manual Assignment (Simple Demo):\n\n';
            output.textContent += 'Available Contacts:\n';
            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} (ID: ${contact.id.substr(-5)})\n`;
            });

            output.textContent += '\nAvailable Groups:\n';
            groups.forEach((group, index) => {
                output.textContent += `${index + 1}. ${group.name} (${group.type})\n`;
            });

            output.textContent += '\nüí° Console Demo:\n';
            output.textContent += 'Try in browser console (F12):\n';
            output.textContent += `groupService.addContactToGroup('${groups[0]?.id}', '${contacts[0]?.id}');\n`;
            output.textContent += 'This demonstrates how services communicate!';
        }

        function listAllContacts() {
            const output = document.getElementById('contact-output');
            const contacts = contactService.getAllContacts();

            output.textContent = `üì± All Contacts (${contacts.length}):\n\n`;
            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name}\n`;
                output.textContent += `   üìû ${contact.phone}\n`;
                output.textContent += `   ‚úâÔ∏è ${contact.email}\n\n`;
            });
        }

        function findContactDemo() {
            const output = document.getElementById('contact-output');
            const searchTerm = 'john';
            const contact = contactService.findContact(searchTerm);

            output.textContent = `üîç Finding contact with name containing "${searchTerm}":\n\n`;
            if (contact) {
                output.textContent += `‚úÖ Found: ${contact.name}\n`;
                output.textContent += `üìû ${contact.phone}\n`;
                output.textContent += `‚úâÔ∏è ${contact.email}`;
            } else {
                output.textContent += `‚ùå No contact found containing "${searchTerm}"`;
            }
        }

        // === GROUP MANAGEMENT FUNCTIONS ===

        function createGroup() {
            const name = document.getElementById('group-name').value.trim();
            const output = document.getElementById('group-output');

            if (name) {
                // Use the group name as its own type (no artificial categorization)
                const groupId = groupService.createGroup(name, name.toLowerCase());
                output.textContent = `‚úÖ Group created: "${name}"\nID: ${groupId}\n\n`;

                // DYNAMIC UPDATE: Refresh checkboxes in contact section
                updateGroupCheckboxes();

                output.textContent += `üîÑ Contact assignment options updated!\n`;
                output.textContent += `üí° Go to Contact Management - "${name}" now available for assignment\n\n`;
                output.textContent += `üîç This demonstrates:\n`;
                output.textContent += `‚Ä¢ Service data driving UI updates\n`;
                output.textContent += `‚Ä¢ Dynamic content generation from service state\n`;
                output.textContent += `‚Ä¢ Flexible group creation (no artificial categories)\n`;
                output.textContent += `‚Ä¢ Real-world contact organization patterns`;

                // Clear input
                document.getElementById('group-name').value = '';
            } else {
                output.textContent = '‚ùå Please enter a group name';
            }
        }


        function manuallyAssignContact() {
            const output = document.getElementById('group-output');
            const contacts = contactService.getAllContacts();
            const groups = groupService.getAllGroups();

            if (contacts.length === 0) {
                output.textContent = '‚ùå Add contacts first!\nUse Contact Management section to add contacts.';
                return;
            }

            if (groups.length === 0) {
                output.textContent = '‚ùå Create groups first!\nUse Group Management section to create groups.';
                return;
            }

            // Simple manual assignment demo
            output.textContent = 'üìù Manual Assignment Demo:\n\n';
            output.textContent += 'üéØ Learning Goal: See how services communicate\n\n';

            // Show first contact and first group as example
            const firstContact = contacts[0];
            const firstGroup = groups[0];

            output.textContent += `Example Assignment:\n`;
            output.textContent += `Contact: ${firstContact.name}\n`;
            output.textContent += `Group: ${firstGroup.name}\n\n`;

            // Perform the assignment
            const success = groupService.addContactToGroup(firstGroup.id, firstContact.id);

            if (success) {
                output.textContent += `‚úÖ Assigned ${firstContact.name} to ${firstGroup.name}\n\n`;
                output.textContent += 'üîç This demonstrates:\n';
                output.textContent += '‚Ä¢ GroupService using ContactService data\n';
                output.textContent += '‚Ä¢ Services communicating through method calls\n';
                output.textContent += '‚Ä¢ Global namespace allowing service access\n\n';
                output.textContent += 'üí° Try "Show Family/Friends/Coworkers" to see the result!';
            } else {
                output.textContent += '‚ö†Ô∏è Assignment may have already existed\n';
                output.textContent += 'This shows duplicate prevention in the service!';
            }
        }

        function listAllGroups() {
            const output = document.getElementById('group-output');
            const groups = groupService.getAllGroups();

            output.textContent = `üë• All Groups (${groups.length}):\n\n`;
            groups.forEach((group, index) => {
                output.textContent += `${index + 1}. ${group.name} (${group.type})\n`;
                output.textContent += `   Members: ${group.contactIds.length}\n\n`;
            });

            if (groups.length === 0) {
                output.textContent += 'üí° Create groups using the input above!';
            }
        }

        // === SEARCH FUNCTIONS ===

        function searchContacts() {
            const searchTerm = document.getElementById('search-term').value;
            const output = document.getElementById('search-output');

            const results = searchService.searchContacts(searchTerm);

            output.textContent = `üîç Search results for "${searchTerm}":\n\n`;
            if (results.length > 0) {
                results.forEach((contact, index) => {
                    output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                });
            } else {
                output.textContent += '‚ùå No contacts found';
            }
        }

        function searchGroups() {
            const searchTerm = document.getElementById('search-term').value;
            const output = document.getElementById('search-output');

            const results = searchService.searchGroups(searchTerm);

            output.textContent = `üîç Group search results for "${searchTerm}":\n\n`;
            if (results.length > 0) {
                results.forEach((group, index) => {
                    output.textContent += `${index + 1}. ${group.name} (${group.type}) - ${group.contactIds.length} members\n`;
                });
            } else {
                output.textContent += '‚ùå No groups found';
            }
        }

        function showGroupsList() {
            const output = document.getElementById('search-output');
            const groups = groupService.getAllGroups();

            if (groups.length === 0) {
                output.textContent = '‚ùå No groups created yet!\n\n';
                output.textContent += 'üí° Create groups using Group Management section';
                return;
            }

            output.textContent = `üë• All Groups & Their Members:\n\n`;

            groups.forEach((group, index) => {
                // Get contacts in this specific group
                const groupContacts = groupService.getContactsInGroup(group.id, contactService);

                output.textContent += `${index + 1}. ${group.name} (${groupContacts.length} members)\n`;

                if (groupContacts.length > 0) {
                    groupContacts.forEach(contact => {
                        output.textContent += `   ‚Ä¢ ${contact.name} - ${contact.phone}\n`;
                    });
                } else {
                    output.textContent += `   (No members yet)\n`;
                }
                output.textContent += `\n`;
            });

            output.textContent += `üîç This demonstrates:\n`;
            output.textContent += `‚Ä¢ GroupService managing any type of group\n`;
            output.textContent += `‚Ä¢ SearchService coordinating with GroupService\n`;
            output.textContent += `‚Ä¢ Flexible contact organization patterns\n`;
            output.textContent += `‚Ä¢ No artificial type restrictions`;
        }

        function showAllContacts() {
            const output = document.getElementById('search-output');
            const contacts = searchService.getAllContacts();

            output.textContent = `üì± All Contacts (${contacts.length}):\n\n`;
            if (contacts.length === 0) {
                output.textContent += 'üí° Add contacts using Contact Management section';
                return;
            }

            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                output.textContent += `   üìß ${contact.email}\n\n`;
            });

            output.textContent += 'üîç This demonstrates:\n';
            output.textContent += '‚Ä¢ SearchService accessing ContactService data\n';
            output.textContent += '‚Ä¢ Service method calls: searchService.getAllContacts()\n';
            output.textContent += '‚Ä¢ Cross-service communication through global namespace';
        }

        function showUnassignedContacts() {
            const output = document.getElementById('search-output');
            const unassignedContacts = searchService.getUnassignedContacts();

            output.textContent = `üìã Unassigned Contacts (${unassignedContacts.length}):\n\n`;

            if (unassignedContacts.length === 0) {
                output.textContent += '‚úÖ All contacts are assigned to groups!\n\n';
                output.textContent += 'üí° Try adding a contact without checking any groups';
            } else {
                unassignedContacts.forEach((contact, index) => {
                    output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                    output.textContent += `   üìß ${contact.email}\n`;
                    output.textContent += `   ID: ${contact.id.substr(-8)}\n\n`;
                });

                output.textContent += 'üîç This demonstrates:\n';
                output.textContent += '‚Ä¢ GroupService finding contacts NOT in any groups\n';
                output.textContent += '‚Ä¢ SearchService coordinating between services\n';
                output.textContent += '‚Ä¢ Optional relationships in service architecture\n\n';

                output.textContent += 'üí° To assign these contacts:\n';
                output.textContent += 'Use console: groupService.addContactToGroup(groupId, contactId)';
            }
        }


        // === ARCHITECTURE DEMONSTRATION ===

        function showGlobalServices() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = `üåê Global Services Available:\n\n`;
            output.textContent += `‚úÖ ContactService: ${typeof window.ContactService === 'function'}\n`;
            output.textContent += `‚úÖ GroupService: ${typeof window.GroupService === 'function'}\n`;
            output.textContent += `‚úÖ SearchService: ${typeof window.SearchService === 'function'}\n\n`;
            output.textContent += `üí° Access them anywhere:\n`;
            output.textContent += `- window.ContactService or just ContactService\n`;
            output.textContent += `- window.GroupService or just GroupService\n`;
            output.textContent += `- window.SearchService or just SearchService`;
        }

        function demonstrateServiceCommunication() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = `üîó Service Communication Demonstration:\n\n`;

            // Show how SearchService uses both other services
            output.textContent += `1. SearchService depends on:\n`;
            output.textContent += `   - ContactService (for contact data)\n`;
            output.textContent += `   - GroupService (for group data)\n\n`;

            output.textContent += `2. When SearchService.createWithGlobalServices() is called:\n`;
            output.textContent += `   - It checks if ContactService exists globally\n`;
            output.textContent += `   - It checks if GroupService exists globally\n`;
            output.textContent += `   - It creates instances of both\n`;
            output.textContent += `   - It uses them to provide search functionality\n\n`;

            output.textContent += `3. This is why load order matters:\n`;
            output.textContent += `   ContactService.js ‚Üí GroupService.js ‚Üí SearchService.js`;
        }

        function showConsoleCommands() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = 'üíª Console Commands for Learning:\n\n';
            output.textContent += 'üéØ Open browser console (F12) and try these:\n\n';

            output.textContent += 'üì± Manual Contact Management:\n';
            output.textContent += `contactService.addContact('Your Name', '555-1234', 'you@email.com');\n`;
            output.textContent += `contactService.findContact('your');\n`;
            output.textContent += `contactService.getAllContacts();\n\n`;

            output.textContent += 'üë• Manual Group Management:\n';
            output.textContent += `groupService.createGroup('My Friends', 'friends');\n`;
            output.textContent += `groupService.getAllGroups();\n\n`;

            output.textContent += 'üîó Manual Assignment (Service Communication):\n';
            output.textContent += '// Get contact and group IDs from lists above, then:\n';
            output.textContent += `groupService.addContactToGroup(groupId, contactId);\n\n`;

            output.textContent += 'üîç Cross-Service Search:\n';
            output.textContent += `searchService.searchContacts('name');\n`;
            output.textContent += `searchService.getContactsByGroupType('friends');\n\n`;

            output.textContent += 'üåê Test Global Namespace:\n';
            output.textContent += `console.log(typeof ContactService);  // "function"\n`;
            output.textContent += `const newInstance = new ContactService();  // Independent data\n\n`;

            output.textContent += 'üí° This manual approach teaches:\n';
            output.textContent += '‚Ä¢ IIFE pattern (global exposure)\n';
            output.textContent += '‚Ä¢ Prototype method sharing\n';
            output.textContent += '‚Ä¢ Service dependencies\n';
            output.textContent += '‚Ä¢ Instance data separation';
        }

        function clearAllData() {
            // Create fresh instances to clear all data
            contactService = new ContactService();
            groupService = new GroupService();
            searchService = SearchService.createWithGlobalServices();

            // Clear all output areas
            document.getElementById('contact-output').textContent = 'All data cleared!';
            document.getElementById('group-output').textContent = 'All data cleared!';
            document.getElementById('search-output').textContent = 'All data cleared!';
            document.getElementById('demo-output').textContent = 'All data cleared!';

            console.log('üóëÔ∏è All data cleared - fresh start!');
        }

        // Global debug function
        window.debugContactManager = function() {
            console.group('üîç Contact Manager Debug Info');
            console.log('ContactService instance:', contactService);
            console.log('GroupService instance:', groupService);
            console.log('SearchService instance:', searchService);
            console.log('Total contacts:', contactService.getContactCount());
            console.log('Total groups:', groupService.getAllGroups().length);
            console.groupEnd();
        };
    </script>
</body>
</html>