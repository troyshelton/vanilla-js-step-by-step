<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📱 Contact Manager - Complete App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .button-group {
            margin: 10px 0;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .danger-btn {
            background: #dc3545;
        }

        .danger-btn:hover {
            background: #c82333;
        }

        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .input-group {
            margin: 10px 0;
        }

        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .stats {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .completion-banner {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="completion-banner">
        <h1>🎓 JavaScript Architecture Demo - Final Version</h1>
        <p><strong>Learning Focus:</strong> See how IIFE, prototypes, and service dependencies work together</p>
        <p>📚 Reference solution for Steps 1-4 | 🎯 Manually input data to learn concepts</p>
    </div>

    <div class="container">
        <h2>📱 Contact Management</h2>

        <div class="input-group">
            <input type="text" id="contact-name" placeholder="Name" value="John Smith">
            <input type="text" id="contact-phone" placeholder="Phone" value="555-0123">
            <input type="text" id="contact-email" placeholder="Email" value="john@email.com">
            <button onclick="addContact()">Add Contact</button>
        </div>

        <div class="button-group">
            <button onclick="listAllContacts()">List All Contacts</button>
            <button onclick="findContactDemo()">Find Contact Demo</button>
        </div>
        <div id="contact-output" class="output">Contact operations will appear here...</div>
    </div>

    <div class="container">
        <h2>👥 Group Management</h2>

        <div class="input-group">
            <input type="text" id="group-name" placeholder="Group Name" value="Best Friends">
            <select id="group-type">
                <option value="family">Family</option>
                <option value="friends" selected>Friends</option>
                <option value="coworkers">Coworkers</option>
            </select>
            <button onclick="createGroup()">Create Group</button>
        </div>

        <div class="button-group">
            <button onclick="listAllGroups()">List All Groups</button>
            <button onclick="manuallyAssignContact()">Assign Contact to Group</button>
        </div>
        <div id="group-output" class="output">Group operations will appear here...</div>
    </div>

    <div class="container">
        <h2>🔍 Search & Reports</h2>

        <div class="input-group">
            <input type="text" id="search-term" placeholder="Search contacts..." value="john">
            <button onclick="searchContacts()">Search Contacts</button>
            <button onclick="searchGroups()">Search Groups</button>
        </div>

        <div class="button-group">
            <button onclick="showAllContacts()">Show All Contacts</button>
            <button onclick="showFamilyContacts()">Show Family</button>
            <button onclick="showFriendsContacts()">Show Friends</button>
            <button onclick="showCoworkerContacts()">Show Coworkers</button>
        </div>
        <div id="search-output" class="output">Search results will appear here...</div>
    </div>

    <div class="container">
        <h2>🧪 JavaScript Architecture Learning</h2>
        <div class="button-group">
            <button onclick="showGlobalServices()">Show Global Services</button>
            <button onclick="demonstrateServiceCommunication()">Service Communication</button>
            <button onclick="showConsoleCommands()">Console Commands Guide</button>
            <button class="danger-btn" onclick="clearAllData()">Clear All Data</button>
        </div>
        <div id="demo-output" class="output">
            🎯 Learning Focus: Manual interaction teaches JavaScript concepts better!<br><br>
            💡 Try adding contacts and groups manually, then use console commands to see how services work together.
        </div>
    </div>

    <!--
        CRITICAL: Load order matters!
        SearchService depends on both ContactService and GroupService
    -->
    <script src="ContactService.js"></script>
    <script src="GroupService.js"></script>
    <script src="SearchService.js"></script>

    <script>
        // Global service instances
        let contactService;
        let groupService;
        let searchService;

        // Initialize services when page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                contactService = new ContactService();
                groupService = new GroupService();
                searchService = SearchService.createWithGlobalServices(contactService, groupService);

                console.log('🎉 All services initialized successfully!');
                generateStats(); // Show initial stats
            } catch (error) {
                console.error('❌ Initialization failed:', error.message);
            }
        });

        // === CONTACT MANAGEMENT FUNCTIONS ===

        function addContact() {
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            const email = document.getElementById('contact-email').value;
            const output = document.getElementById('contact-output');

            if (name && phone && email) {
                const contactId = contactService.addContact(name, phone, email);
                output.textContent = `✅ Contact added: ${name}\nID: ${contactId}\nPhone: ${phone}\nEmail: ${email}`;

                // Clear inputs
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-phone').value = '';
                document.getElementById('contact-email').value = '';
            } else {
                output.textContent = '❌ Please fill in all fields (name, phone, email)';
            }
        }

        function manuallyAssignContact() {
            const output = document.getElementById('group-output');
            const contacts = contactService.getAllContacts();
            const groups = groupService.getAllGroups();

            if (contacts.length === 0) {
                output.textContent = '❌ No contacts found!\nAdd contacts first using the Contact Management section.';
                return;
            }

            if (groups.length === 0) {
                output.textContent = '❌ No groups found!\nCreate groups first using the Group Management section.';
                return;
            }

            // Simple manual assignment interface
            output.textContent = '📝 Manual Assignment (Simple Demo):\n\n';
            output.textContent += 'Available Contacts:\n';
            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} (ID: ${contact.id.substr(-5)})\n`;
            });

            output.textContent += '\nAvailable Groups:\n';
            groups.forEach((group, index) => {
                output.textContent += `${index + 1}. ${group.name} (${group.type})\n`;
            });

            output.textContent += '\n💡 Console Demo:\n';
            output.textContent += 'Try in browser console (F12):\n';
            output.textContent += `groupService.addContactToGroup('${groups[0]?.id}', '${contacts[0]?.id}');\n`;
            output.textContent += 'This demonstrates how services communicate!';
        }

        function listAllContacts() {
            const output = document.getElementById('contact-output');
            const contacts = contactService.getAllContacts();

            output.textContent = `📱 All Contacts (${contacts.length}):\n\n`;
            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name}\n`;
                output.textContent += `   📞 ${contact.phone}\n`;
                output.textContent += `   ✉️ ${contact.email}\n\n`;
            });
        }

        function findContactDemo() {
            const output = document.getElementById('contact-output');
            const searchTerm = 'john';
            const contact = contactService.findContact(searchTerm);

            output.textContent = `🔍 Finding contact with name containing "${searchTerm}":\n\n`;
            if (contact) {
                output.textContent += `✅ Found: ${contact.name}\n`;
                output.textContent += `📞 ${contact.phone}\n`;
                output.textContent += `✉️ ${contact.email}`;
            } else {
                output.textContent += `❌ No contact found containing "${searchTerm}"`;
            }
        }

        // === GROUP MANAGEMENT FUNCTIONS ===

        function createGroup() {
            const name = document.getElementById('group-name').value;
            const type = document.getElementById('group-type').value;
            const output = document.getElementById('group-output');

            if (name) {
                const groupId = groupService.createGroup(name, type);
                output.textContent = `✅ Group created: "${name}" (${type})\nID: ${groupId}`;

                // Clear input
                document.getElementById('group-name').value = '';
            } else {
                output.textContent = '❌ Please enter a group name';
            }
        }


        function manuallyAssignContact() {
            const output = document.getElementById('group-output');
            const contacts = contactService.getAllContacts();
            const groups = groupService.getAllGroups();

            if (contacts.length === 0) {
                output.textContent = '❌ Add contacts first!\nUse Contact Management section to add contacts.';
                return;
            }

            if (groups.length === 0) {
                output.textContent = '❌ Create groups first!\nUse Group Management section to create groups.';
                return;
            }

            // Simple manual assignment demo
            output.textContent = '📝 Manual Assignment Demo:\n\n';
            output.textContent += '🎯 Learning Goal: See how services communicate\n\n';

            // Show first contact and first group as example
            const firstContact = contacts[0];
            const firstGroup = groups[0];

            output.textContent += `Example Assignment:\n`;
            output.textContent += `Contact: ${firstContact.name}\n`;
            output.textContent += `Group: ${firstGroup.name}\n\n`;

            // Perform the assignment
            const success = groupService.addContactToGroup(firstGroup.id, firstContact.id);

            if (success) {
                output.textContent += `✅ Assigned ${firstContact.name} to ${firstGroup.name}\n\n`;
                output.textContent += '🔍 This demonstrates:\n';
                output.textContent += '• GroupService using ContactService data\n';
                output.textContent += '• Services communicating through method calls\n';
                output.textContent += '• Global namespace allowing service access\n\n';
                output.textContent += '💡 Try "Show Family/Friends/Coworkers" to see the result!';
            } else {
                output.textContent += '⚠️ Assignment may have already existed\n';
                output.textContent += 'This shows duplicate prevention in the service!';
            }
        }

        function listAllGroups() {
            const output = document.getElementById('group-output');
            const groups = groupService.getAllGroups();

            output.textContent = `👥 All Groups (${groups.length}):\n\n`;
            groups.forEach((group, index) => {
                output.textContent += `${index + 1}. ${group.name} (${group.type})\n`;
                output.textContent += `   Members: ${group.contactIds.length}\n\n`;
            });

            if (groups.length === 0) {
                output.textContent += '💡 Create groups using the input above!';
            }
        }

        // === SEARCH FUNCTIONS ===

        function searchContacts() {
            const searchTerm = document.getElementById('search-term').value;
            const output = document.getElementById('search-output');

            const results = searchService.searchContacts(searchTerm);

            output.textContent = `🔍 Search results for "${searchTerm}":\n\n`;
            if (results.length > 0) {
                results.forEach((contact, index) => {
                    output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                });
            } else {
                output.textContent += '❌ No contacts found';
            }
        }

        function searchGroups() {
            const searchTerm = document.getElementById('search-term').value;
            const output = document.getElementById('search-output');

            const results = searchService.searchGroups(searchTerm);

            output.textContent = `🔍 Group search results for "${searchTerm}":\n\n`;
            if (results.length > 0) {
                results.forEach((group, index) => {
                    output.textContent += `${index + 1}. ${group.name} (${group.type}) - ${group.contactIds.length} members\n`;
                });
            } else {
                output.textContent += '❌ No groups found';
            }
        }

        function showFamilyContacts() {
            const output = document.getElementById('search-output');
            const familyContacts = searchService.getContactsByGroupType('family');

            output.textContent = `👨‍👩‍👧‍👦 Family Contacts (${familyContacts.length}):\n\n`;
            familyContacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
            });
        }

        function showFriendsContacts() {
            const output = document.getElementById('search-output');
            const friendsContacts = searchService.getContactsByGroupType('friends');

            output.textContent = `👫 Friends (${friendsContacts.length}):\n\n`;
            friendsContacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
            });
        }

        function showCoworkerContacts() {
            const output = document.getElementById('search-output');
            const coworkerContacts = searchService.getContactsByGroupType('coworkers');

            output.textContent = `💼 Coworkers (${coworkerContacts.length}):\n\n`;
            coworkerContacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
            });
        }

        function showAllContacts() {
            const output = document.getElementById('search-output');
            const contacts = searchService.getAllContacts();

            output.textContent = `📱 All Contacts (${contacts.length}):\n\n`;
            if (contacts.length === 0) {
                output.textContent += '💡 Add contacts using Contact Management section';
                return;
            }

            contacts.forEach((contact, index) => {
                output.textContent += `${index + 1}. ${contact.name} - ${contact.phone}\n`;
                output.textContent += `   📧 ${contact.email}\n\n`;
            });

            output.textContent += '🔍 This demonstrates:\n';
            output.textContent += '• SearchService accessing ContactService data\n';
            output.textContent += '• Service method calls: searchService.getAllContacts()\n';
            output.textContent += '• Cross-service communication through global namespace';
        }


        // === ARCHITECTURE DEMONSTRATION ===

        function showGlobalServices() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = `🌐 Global Services Available:\n\n`;
            output.textContent += `✅ ContactService: ${typeof window.ContactService === 'function'}\n`;
            output.textContent += `✅ GroupService: ${typeof window.GroupService === 'function'}\n`;
            output.textContent += `✅ SearchService: ${typeof window.SearchService === 'function'}\n\n`;
            output.textContent += `💡 Access them anywhere:\n`;
            output.textContent += `- window.ContactService or just ContactService\n`;
            output.textContent += `- window.GroupService or just GroupService\n`;
            output.textContent += `- window.SearchService or just SearchService`;
        }

        function demonstrateServiceCommunication() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = `🔗 Service Communication Demonstration:\n\n`;

            // Show how SearchService uses both other services
            output.textContent += `1. SearchService depends on:\n`;
            output.textContent += `   - ContactService (for contact data)\n`;
            output.textContent += `   - GroupService (for group data)\n\n`;

            output.textContent += `2. When SearchService.createWithGlobalServices() is called:\n`;
            output.textContent += `   - It checks if ContactService exists globally\n`;
            output.textContent += `   - It checks if GroupService exists globally\n`;
            output.textContent += `   - It creates instances of both\n`;
            output.textContent += `   - It uses them to provide search functionality\n\n`;

            output.textContent += `3. This is why load order matters:\n`;
            output.textContent += `   ContactService.js → GroupService.js → SearchService.js`;
        }

        function showConsoleCommands() {
            const output = document.getElementById('demo-output');
            output.textContent = '';

            output.textContent = '💻 Console Commands for Learning:\n\n';
            output.textContent += '🎯 Open browser console (F12) and try these:\n\n';

            output.textContent += '📱 Manual Contact Management:\n';
            output.textContent += `contactService.addContact('Your Name', '555-1234', 'you@email.com');\n`;
            output.textContent += `contactService.findContact('your');\n`;
            output.textContent += `contactService.getAllContacts();\n\n`;

            output.textContent += '👥 Manual Group Management:\n';
            output.textContent += `groupService.createGroup('My Friends', 'friends');\n`;
            output.textContent += `groupService.getAllGroups();\n\n`;

            output.textContent += '🔗 Manual Assignment (Service Communication):\n';
            output.textContent += '// Get contact and group IDs from lists above, then:\n';
            output.textContent += `groupService.addContactToGroup(groupId, contactId);\n\n`;

            output.textContent += '🔍 Cross-Service Search:\n';
            output.textContent += `searchService.searchContacts('name');\n`;
            output.textContent += `searchService.getContactsByGroupType('friends');\n\n`;

            output.textContent += '🌐 Test Global Namespace:\n';
            output.textContent += `console.log(typeof ContactService);  // "function"\n`;
            output.textContent += `const newInstance = new ContactService();  // Independent data\n\n`;

            output.textContent += '💡 This manual approach teaches:\n';
            output.textContent += '• IIFE pattern (global exposure)\n';
            output.textContent += '• Prototype method sharing\n';
            output.textContent += '• Service dependencies\n';
            output.textContent += '• Instance data separation';
        }

        function clearAllData() {
            // Create fresh instances to clear all data
            contactService = new ContactService();
            groupService = new GroupService();
            searchService = SearchService.createWithGlobalServices();

            // Clear all output areas
            document.getElementById('contact-output').textContent = 'All data cleared!';
            document.getElementById('group-output').textContent = 'All data cleared!';
            document.getElementById('search-output').textContent = 'All data cleared!';
            document.getElementById('demo-output').textContent = 'All data cleared!';

            console.log('🗑️ All data cleared - fresh start!');
        }

        // Global debug function
        window.debugContactManager = function() {
            console.group('🔍 Contact Manager Debug Info');
            console.log('ContactService instance:', contactService);
            console.log('GroupService instance:', groupService);
            console.log('SearchService instance:', searchService);
            console.log('Total contacts:', contactService.getContactCount());
            console.log('Total groups:', groupService.getAllGroups().length);
            console.groupEnd();
        };
    </script>
</body>
</html>